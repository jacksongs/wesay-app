import{a as C}from"./chunk-6RQN4WPG.91905214.mjs";import{s as y,i as L,p as O,e as m,a as w,b as I,c as H,d as v,l as M,f as V,H as F,D as g,k as N,g as A,h as J}from"./register-7ME6RV76.5b73e7fe.mjs";async function K(e,{player:t,delegate:u,logger:o}){const n={onLoadStart(){v(t,"hls-lib-load-start")},onLoaded(s){v(t,"hls-lib-loaded",{detail:s})},onLoadError(s){const d=A(s);v(t,"hls-lib-load-error",{detail:d}),u.dispatch("error",{detail:{message:d.message,code:4}})}};let i=await q(e,n);if(H(i)&&!L(e)&&(i=await U(e,n)),!i)return null;if(!i.isSupported()){const s="[vidstack]: `hls.js` is not supported in this environment";return v(t,"hls-unsupported"),u.dispatch("error",{detail:{message:s,code:4}}),null}return i}async function U(e,t={}){var u,o,n,i,s;if(!H(e)){if((u=t.onLoadStart)==null||u.call(t),e.prototype&&e.prototype!==Function)return(o=t.onLoaded)==null||o.call(t,e),e;try{const d=(n=await e())==null?void 0:n.default;if(d&&d.isSupported)(i=t.onLoaded)==null||i.call(t,d);else throw Error("");return d}catch(d){(s=t.onLoadError)==null||s.call(t,d)}}}async function q(e,t={}){var u,o,n;if(L(e)){(u=t.onLoadStart)==null||u.call(t);try{if(await M(e),!V(window.Hls))throw Error("");const i=window.Hls;return(o=t.onLoaded)==null||o.call(t,i),i}catch(i){(n=t.onLoadError)==null||n.call(t,i)}}}var x=e=>J(e),z=e=>N(e);function B(e,t,u,o,{player:n,logger:i,delegate:s,$store:d},l){const E=new Set;m(()=>{const h=u();if(!h)return;const r=new h(t);m(()=>void T(r,n[F]())),r.on(h.Events.ERROR,P),o.set(r);for(const p of l)p(r);v(n,"hls-instance",{detail:r}),r.attachMedia(e.media);const a=w(u).Events.LEVEL_LOADED;return r.once(a,R),s.dispatch("provider-setup",{detail:e}),()=>{E.clear(),r.destroy(),o.set(null)}});function D(h,r){n.dispatchEvent(new g(x(h),{detail:r}))}function T(h,r){for(const a of r)E.has(a)||(h.on(z(a),D),E.add(a))}function R(h,r){if(d.canPlay)return;const{live:a,totalduration:p}=r.details,f=new g(h,{detail:r}),_=a?"live-video":"video";s.dispatch("media-change",{detail:_,trigger:f}),s.dispatch("duration-change",{detail:p,trigger:f});const S=o(),c=S.media;c.dispatchEvent(new g("canplay",{trigger:f})),!d.autoplay&&a&&S.liveSyncPosition&&(c.currentTime=S.liveSyncPosition)}function P(h,r){var a,p,f;if(r.fatal)switch(r.type){case"networkError":(a=o())==null||a.startLoad();break;case"mediaError":(p=o())==null||p.recoverMediaError();break;default:(f=o())==null||f.destroy(),o.set(null);break}}}var G=Symbol(0),Q="https://cdn.jsdelivr.net",j,W=class extends C{constructor(){super(...arguments),this[j]=!0,this.r=y(null),this.l=y(null),this.s=new Set,this.j=`${Q}/npm/hls.js@^1.0.0/dist/hls.min.js`,this.config={}}get type(){return"hls"}get library(){return this.j}set library(e){this.j=e}preconnect(){L(this.j)&&O(this.j)}setup(e){super.setup(e),K(this.j,e).then(t=>this.r.set(()=>t)),B(this,this.config,this.r,this.l,e,this.s)}get ctor(){return this.r()}get instance(){return this.l()}async loadSource({src:e}){m(()=>{if(!L(e))return;const t=this.l();t==null||t.loadSource(e)})}onInstance(e){const t=w(this.l);return t&&e(t),this.s.add(e),()=>this.s.delete(e)}};j=G;W.supported=I();export{W as HLSProvider,G as HLS_PROVIDER};
