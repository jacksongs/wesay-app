import{m as z,n as G,i as J,u as K,o as Q,j as X,I as Y,q as Z,c as p,r as $,t as y,d as L,v}from"./register-7ME6RV76.5b73e7fe.mjs";function tt(i){let n;function u(){p(n)&&a()}function a(){n=window.requestAnimationFrame(function(){p(n)||(i(),a())})}function l(){$(n)&&window.cancelAnimationFrame(n),n=void 0}return{start:u,stop:l}}function it(i,{player:n,$store:u,delegate:a,logger:l}){const o=K();let r=!1,f=!1,h=!1,c=!1;const d=tt(()=>{const t=i.currentTime;u.currentTime!==t&&m(t)});T(),Q(()=>{d.stop(),o.empty()});function e(t,s){return X(i.media,t,s)}function T(){e("loadstart",E),e("abort",g),e("emptied",C),e("error",_)}function S(){f||(o.add(e("loadeddata",M),e("loadedmetadata",k),e("canplay",F),e("canplaythrough",R),e("durationchange",H),e("progress",W),e("stalled",N),e("suspend",B)),f=!0)}function b(){h||(o.add(e("play",P),e("pause",A),e("playing",D),e("ratechange",V),e("seeked",O),e("seeking",U),e("ended",q),e("volumechange",I),e("waiting",j)),h=!0)}function m(t,s){a.dispatch("time-update",{detail:{currentTime:Math.min(t,i.media.duration),played:i.media.played},trigger:s})}function g(t){c=!1,a.dispatch("abort",{trigger:t})}function E(t){if(c=!1,i.media.networkState===3){g(t);return}S(),a.dispatch("load-start",{trigger:t})}function C(t){a.dispatch("emptied",{trigger:t})}function M(t){a.dispatch("loaded-data",{trigger:t})}function k(t){w(),b(),a.dispatch("volume-change",{detail:{volume:i.media.volume,muted:i.media.muted}}),a.dispatch("loaded-metadata",{trigger:t}),Y&&Z(u.source)&&a.ready({duration:i.media.duration},t)}function w(){!Number.isFinite(i.media.duration)&&a.dispatch("media-change",{detail:"live-video"})}function P(t){a.dispatch("play",{trigger:t})}function A(t){i.media.readyState===1&&!r||(r=!1,d.stop(),a.dispatch("pause",{trigger:t}))}function F(t){a.ready({duration:i.media.duration},t)}function R(t){u.started||a.dispatch("can-play-through",{trigger:t,detail:{duration:i.media.duration}})}function D(t){if(r=!1,a.dispatch("playing",{trigger:t}),d.start(),!c&&u.live){const s=u.seekable.end(0);Number.isFinite(s)&&(i.media.currentTime=s),c=!0}}function N(t){a.dispatch("stalled",{trigger:t}),i.media.readyState<3&&(r=!0,a.dispatch("waiting",{trigger:t}))}function j(t){i.media.readyState<3&&(r=!0,a.dispatch("waiting",{trigger:t}))}function q(t){d.stop(),m(i.media.duration,t),a.dispatch("end",{trigger:t}),u.loop?x():a.dispatch("ended",{trigger:t})}function H(t){u.ended&&m(i.media.duration,t),a.dispatch("duration-change",{detail:i.media.duration,trigger:t})}function I(t){a.dispatch("volume-change",{detail:{volume:i.media.volume,muted:i.media.muted},trigger:t})}function O(t){a.dispatch("seeked",{detail:i.media.currentTime,trigger:t}),Math.trunc(i.media.currentTime)===Math.trunc(i.media.duration)&&y(i.media.duration)>y(i.media.currentTime)&&(m(i.media.duration,t),i.media.ended||L(n,"media-play-request"))}function U(t){a.dispatch("seeking",{detail:i.media.currentTime,trigger:t})}function W(t){a.dispatch("progress",{detail:{buffered:i.media.buffered,seekable:i.media.seekable},trigger:t})}function x(){v(i.media.controls)&&(i.media.controls=!1),L(n,"media-loop-request")}function B(t){a.dispatch("suspend",{trigger:t})}function V(t){}function _(t){const s=i.media.error;s&&a.dispatch("error",{detail:{message:s.message,code:s.code,mediaError:s},trigger:t})}}var et=class{constructor(i){this.c=i}setup(i){it(this,i)}get type(){return""}get media(){return this.c}get paused(){return this.c.paused}get muted(){return this.c.muted}set muted(i){this.c.muted=i}get volume(){return this.c.volume}set volume(i){this.c.volume=i}get currentTime(){return this.c.currentTime}set currentTime(i){this.c.currentTime=i}get playsinline(){return this.c.hasAttribute("playsinline")}set playsinline(i){z(this.c,"playsinline",i)}async play(){return this.c.play()}async pause(){return this.c.pause()}async loadSource({src:i},n){this.c.preload=n,G(i)?this.c.srcObject=i:(this.c.srcObject=null,this.c.src=J(i)?i:window.URL.createObjectURL(i)),this.c.load()}};export{et as H};
